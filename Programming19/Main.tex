\documentclass[english,submission]{programming}

\usepackage{mathtools}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{xspace}
\usepackage{xypic}
\usepackage{hyperref}
%\usepackage{amsmath}
\usepackage{url}
\usepackage{syntax}
\usepackage{textcomp}
\usepackage{color}
\usepackage{comment}
\newcommand{\dsl}{\textsc{Scans}\xspace}
\newcommand{\interp}{\textsc{Interpreter}\xspace}
\newcommand{\an}[3]{}
%\newcommand{\an}[3]{{\color{#2} {#1}:#3}}
\newcommand{\weixin}[1]{\an{weixin}{cyan}{#1}}
\newcommand{\bruno}[1]{\an{bruno}{blue}{#1}}

\DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}

\defcaptionname{english}{\sectionautorefname}{Section}
% for code that uses string literal in lhs2TeX
\DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\texttt}

\let\oldpar\paragraph
\renewcommand{\paragraph}[1]{\vspace{-7pt}\oldpar{#1}}
%\let\oldsec\section
%\renewcommand{\section}[1]{\vspace{-7pt}\oldsec{#1}}
\let\oldsubsec\subsection
\renewcommand{\subsection}[1]{\vspace{-7pt}\oldsubsec{#1}}

%% for comments
\input{Preamble}
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10011007.10011006.10011008.10011024</concept_id>
<concept_desc>Software and its engineering~Language features</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10011007.10011006.10011050.10011017</concept_id>
<concept_desc>Software and its engineering~Domain specific languages</concept_desc>
<concept_significance>500</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~Language features}
\ccsdesc[500]{Software and its engineering~Domain specific languages}
% Document starts
\begin{document}

% Title portion
\title{Shallow EDSLs and Object-Oriented Programming}
\subtitle{Beyond Simple Compositionality}

\author[a]{Weixin Zhang}
\author[a]{Bruno C. d. S. Oliveira}
\affiliation[a]{The University of Hong Kong, Hong Kong, China}

\paperdetails{
  %% perspective options are: art, sciencetheoretical, scienceempirical, engineering.
  %% Choose exactly the one that best describes this work. (see 2.1)
  perspective=art,
  %% State one or more areas, separated by a comma. (see 2.2)
  %% Please see list of areas in http://programming-journal.org/cfp/
  %% The list is open-ended, so use other areas if yours is/are not listed.
  area={Domain-Specific Languages, Modularity and Separation of Concerns},
  %% You may choose the license for your paper (see 3.)
  %% License options include: cc-by (default), cc-by-nc
  % license=cc-by,
}

\maketitle

\begin{abstract}

{\bf Context.} 
Embedded Domain-Specific Languages (EDSLs) are a common and widely
used approach to
DSLs in various languages, including Haskell and Scala. There are two
main implementation techniques for EDSLs: \emph{shallow embeddings}
and \emph{deep embeddings}. 

{\bf Inquiry.} Shallow embeddings are quite simple, 
but they have been criticized in the past for being quite limited in
terms of modularity and reuse. In particular, it is often argued that
supporting multiple DSL interpretations in shallow embeddings is difficult.


{\bf Approach.}
This paper argues that shallow EDSLs and Object-Oriented
Programming (OOP) are closely related. Gibbons and Wu already
discussed the relationship between shallow EDSLs and procedural
abstraction, while Cook discussed the connection between procedural
abstraction and OOP. We make the transitive step in this paper by
connecting shallow EDSLs directly to OOP via procedural abstraction. 
The knowledge about this relationship enables us to
improve on implementation techniques for EDSLs.

{\bf Knowledge.}
This paper argues that common OOP mechanisms
(including \emph{inheritance}, \emph{subtyping}, and
\emph{type-refinement})
increase the modularity and reuse of shallow
EDSLs when compared to classical procedural abstraction by enabling a
simple way to express \emph{multiple, possibly dependent,
  interpretations}. 

{\bf Grounding.}
We make our arguments by using Gibbons and Wu's examples, where procedural
abstraction is used in Haskell to model a simple shallow EDSL. We recode that
EDSL in Scala and with an improved OO-inspired Haskell encoding.
We further illustrate our approach with
a case study on refactoring a deep external SQL DSL implementation to make it
more modular, shallow, and embedded.

{\bf Importance.} This work is important for two reasons.
Firstly, from an intellectual point of view, this work
establishes the connection between shallow embeddings and OOP, which enables a
better understanding of both concepts. Secondly, this work
illustrates programming techniques that can be used to improve 
the modularity and reuse of shallow EDSLs.  
\end{abstract}

\input{sections/Introduction}

\input{sections/ShallowOO}

\input{sections/Interpretations}

\input{sections/TypeClass}

\input{sections/Factory}

\input{sections/Casestudy}

\input{sections/Conclusion}

% Bibliography
%\renewcommand{\section}[1]{\oldsec{#1}}
\acks We thank Willam R. Cook, Jeremy Gibbons, Ralf Hinze, Martin Erwig and anonymous
reviewers for their valuable comments that significantly improved this work.
%This work is originally part of the first author's master thesis~\cite{}.
This work has been funded by Hong Kong Research Grant Council projects number
...


\bibliography{Main}

% History dates
%\received{February 2007}{March 2009}{June 2009}

\end{document}
